# Completeness Validation Rules v0.3.0
#
# Domain-aware completeness rules for SCS 0.3 multi-domain architecture
# Projects can customize by creating .scs/completeness-rules.yaml
# Based on SCS 0.3 specification with domain bundles and concern bundles

version: "0.3.0"
description: "Domain-aware completeness rules for SCS 0.3 multi-domain projects"
profile: "comprehensive"  # Requires all concerns within imported domains

# Validation Level 6: Completeness/Compliance
level: 6
severity: "error"  # Strict by default (can be overridden to "warning" in custom rules)

# Required Bundle Types (0.3 Architecture)
required_bundles:
  - type: "meta"
    count: 1
    message: "Project must import exactly 1 meta bundle"

  - type: "standards"
    count: 1
    message: "Project must import at least 1 standards bundle"
    min: 1  # At least 1, but can have more

  - type: "domain"
    count: 1
    message: "Project must import at least 1 domain bundle (e.g., software-development, legal, clinical)"
    min: 1  # At least 1, can have multiple domains

# Domain-Specific Completeness Rules
# The Software Development domain defines 11 concerns
domains:
  software-development:
    id: "domain:software-development"
    name: "Software Development"
    description: "Software engineering domain with 11 concern areas"

    required_concerns:
      - business-context
      - architecture
      - security
      - performance-reliability
      - usability-accessibility
      - compliance-governance
      - data-provenance
      - testing-validation
      - deployment-operations
      - safety-risk
      - ethics-ai-accountability

    concerns:
      - id: "business-context"
        name: "Business Context"
        description: "Foundational business and product context (problem, stakeholders, objectives, opportunity)"
        minimum_scds: 1

        recommended_scds:
          - pattern: "problem|problem-definition|root-cause"
            name: "Problem definition"
            description: "Core problem, affected populations, pain points, root causes"
            severity: "warning"

          - pattern: "stakeholder|stakeholders"
            name: "Stakeholder analysis"
            description: "Stakeholder groups, roles, needs, goals, constraints"
            severity: "warning"

          - pattern: "business-objective|objectives|goals"
            name: "Business objectives"
            description: "Strategic objectives, measurable outcomes, KPIs"
            severity: "warning"

          - pattern: "opportunity|market|opportunity-analysis"
            name: "Opportunity analysis"
            description: "Market context, competitive landscape, why now"
            severity: "warning"

        key_concerns:
          - "Problem definition"
          - "Stakeholder alignment"
          - "Business value"
          - "Success measurement"

      - id: "architecture"
        name: "Architecture"
        description: "System structure, components, boundaries, and technical design"
        minimum_scds: 1

        recommended_scds:
          - pattern: "system-context|system-boundary|context"
            name: "System context and boundaries"
            description: "Defines system boundaries and external integrations"
            severity: "warning"

          - pattern: "tech-stack|technology|stack"
            name: "Technology stack"
            description: "Technologies, frameworks, and platforms used"
            severity: "warning"

          - pattern: "component|architecture-model|components"
            name: "Component model"
            description: "System components and their relationships"
            severity: "warning"

        key_concerns:
          - "System boundaries"
          - "Component relationships"
          - "Technology choices"

      - id: "security"
        name: "Security"
        description: "Security architecture, threat models, authentication, authorization, data protection"
        minimum_scds: 1

        recommended_scds:
          - pattern: "auth|authn|authz|authentication|authorization|access-control"
            name: "Authentication and authorization"
            description: "How users are authenticated and authorized"
            severity: "warning"

          - pattern: "data-protection|encryption|data-security"
            name: "Data protection"
            description: "How sensitive data is protected"
            severity: "warning"

          - pattern: "threat|security-risks|threat-model"
            name: "Threat model"
            description: "Identified threats and mitigation strategies"
            severity: "warning"

        key_concerns:
          - "Authentication/Authorization"
          - "Data encryption"
          - "Threat mitigation"

      - id: "performance-reliability"
        name: "Performance & Reliability"
        description: "Performance requirements, reliability targets, scalability, availability"
        minimum_scds: 1

        recommended_scds:
          - pattern: "performance|perf-requirements"
            name: "Performance requirements"
            description: "Response time, throughput, and resource usage targets"
            severity: "warning"

          - pattern: "scalability|scaling"
            name: "Scalability approach"
            description: "How system scales to handle load"
            severity: "warning"

        key_concerns:
          - "Response times"
          - "Throughput"
          - "Uptime targets"

      - id: "usability-accessibility"
        name: "Usability & Accessibility"
        description: "User experience, interface design, accessibility requirements"
        minimum_scds: 1

        recommended_scds:
          - pattern: "ux|user-experience|usability"
            name: "User experience approach"
            description: "UX principles and design philosophy"
            severity: "warning"

          - pattern: "accessibility|a11y|wcag"
            name: "Accessibility requirements"
            description: "Accessibility standards and compliance (WCAG, etc.)"
            severity: "warning"

        key_concerns:
          - "User experience"
          - "Accessibility standards"

      - id: "compliance-governance"
        name: "Compliance & Governance"
        description: "Regulatory compliance, audit requirements, governance policies"
        minimum_scds: 1

        recommended_scds:
          - pattern: "compliance|regulatory|compliance-mapping"
            name: "Compliance mapping"
            description: "How project satisfies regulatory requirements"
            severity: "warning"

          - pattern: "audit|audit-requirements"
            name: "Audit requirements"
            description: "Audit trail and evidence collection"
            severity: "warning"

        key_concerns:
          - "Regulatory compliance"
          - "Audit trails"
          - "Policy enforcement"

      - id: "data-provenance"
        name: "Data & Provenance"
        description: "Data models, data flow, data governance, provenance tracking"
        minimum_scds: 1

        recommended_scds:
          - pattern: "data-model|data-models|schema"
            name: "Data model"
            description: "Core data structures and relationships"
            severity: "warning"

          - pattern: "data-flow|data-pipeline"
            name: "Data flow"
            description: "How data moves through the system"
            severity: "warning"

        key_concerns:
          - "Data models"
          - "Data lineage"
          - "Data quality"

      - id: "testing-validation"
        name: "Testing & Validation"
        description: "Testing strategy, validation approach, quality assurance"
        minimum_scds: 1

        recommended_scds:
          - pattern: "testing|test-strategy"
            name: "Testing strategy"
            description: "Overall testing approach and methodology"
            severity: "warning"

          - pattern: "test-coverage|coverage"
            name: "Test coverage requirements"
            description: "Required test coverage levels"
            severity: "warning"

        key_concerns:
          - "Test coverage"
          - "Validation methods"
          - "Quality gates"

      - id: "deployment-operations"
        name: "Deployment & Operations"
        description: "Deployment strategy, operational procedures, monitoring, incident response"
        minimum_scds: 1

        recommended_scds:
          - pattern: "deployment|deploy-strategy|cicd"
            name: "Deployment strategy"
            description: "How software is deployed to environments"
            severity: "warning"

          - pattern: "monitoring|observability"
            name: "Monitoring approach"
            description: "System monitoring and observability"
            severity: "warning"

        key_concerns:
          - "Deployment pipeline"
          - "Monitoring"
          - "Incident management"

      - id: "safety-risk"
        name: "Safety & Risk"
        description: "Safety requirements, risk assessment, hazard analysis"
        minimum_scds: 1

        recommended_scds:
          - pattern: "risk|risk-assessment"
            name: "Risk assessment"
            description: "Identified risks and mitigation strategies"
            severity: "warning"

          - pattern: "safety|safety-requirements"
            name: "Safety requirements"
            description: "Safety-critical requirements and controls"
            severity: "warning"

        key_concerns:
          - "Safety-critical functions"
          - "Risk assessment"
          - "Hazard mitigation"

      - id: "ethics-ai-accountability"
        name: "Ethics & AI Accountability"
        description: "Ethical considerations, AI/ML governance, bias mitigation, explainability"
        minimum_scds: 1

        recommended_scds:
          - pattern: "ethics|ai-ethics|ethical"
            name: "AI ethics framework"
            description: "Ethical principles for AI/ML usage"
            severity: "warning"

          - pattern: "bias|bias-mitigation|fairness"
            name: "Bias mitigation"
            description: "How bias is detected and mitigated"
            severity: "warning"

        key_concerns:
          - "Ethical AI use"
          - "Bias detection/mitigation"
          - "Explainability"

  # Placeholder for other domains (Legal, Clinical, etc.)
  # Domain experts will define their own concern completeness rules
  legal:
    id: "domain:legal"
    name: "Legal Practice"
    description: "Legal domain with case management, research, and drafting concerns"
    enabled: false
    note: "Domain-specific rules to be defined by legal domain experts"

  clinical:
    id: "domain:clinical"
    name: "Clinical Practice"
    description: "Clinical domain with patient care and treatment concerns"
    enabled: false
    note: "Domain-specific rules to be defined by clinical domain experts"

# Stub Detection Configuration
stub_detection:
  enabled: true
  description: "Detect placeholder/stub SCDs that lack real content"

  indicators:
    - check: "short_description"
      threshold: 50  # Characters
      message: "SCD description is very short (< 50 chars)"

    - check: "minimal_content"
      threshold: 2  # Fields
      message: "SCD content has fewer than 2 fields"

    - check: "generic_title"
      patterns: ["tbd", "todo", "placeholder", "stub", "example", "template"]
      message: "SCD title appears to be a placeholder"

    - check: "no_relationships"
      message: "SCD has no relationships defined"

  stub_threshold: 2  # If 2+ indicators trigger, warn about stub
  severity: "warning"

  warning_message: >
    SCD '{scd_id}' appears to be a stub or placeholder.
    Consider adding more detailed content before versioning.

# Compliance Validation
compliance_validation:
  enabled: true
  severity: "error"  # Can be overridden to "warning" in custom rules

  checks:
    - check: "standards_bundle_present"
      description: "Project must import at least one standards bundle"
      severity: "error"

    - check: "standards_satisfied"
      description: "All standards SCDs should be satisfied by project SCDs"
      severity: "warning"  # Warning, not error (some standards may not require satisfaction)
      relationship_type: "satisfies"

# Customization Guidance
customization:
  description: "Projects can customize these rules by creating .scs/completeness-rules.yaml"

  common_customizations:
    - scenario: "Early-stage project / POC"
      suggestion: "Reduce required concerns to 3-5 key areas"
      example_concerns: ["architecture", "security", "testing-validation"]

    - scenario: "Non-UI system"
      suggestion: "Remove usability-accessibility from required concerns"

    - scenario: "Non-AI system"
      suggestion: "Remove ethics-ai-accountability from required concerns"

    - scenario: "Internal tool"
      suggestion: "Set compliance_validation severity to 'warning'"

    - scenario: "Multi-domain project"
      suggestion: "Import multiple domain bundles (e.g., software-development + clinical)"

  override_location: ".scs/completeness-rules.yaml"

  priority:
    - "1. Explicit --completeness-rules flag (highest)"
    - "2. Project .scs/completeness-rules.yaml"
    - "3. This default file (fallback)"

# Error Messages
error_messages:
  missing_domain:
    "Required domain bundle '{domain}' not found in project. Expected: bundle:{domain}"

  missing_concern:
    "Required concern '{concern}' not found in domain '{domain}'. Expected: bundle:{concern}"

  insufficient_scds_in_concern:
    "Concern '{concern}' bundle has {actual} SCD(s) but requires at least {required}"

  missing_recommended_scd:
    "Concern '{concern}' is missing recommended SCD matching pattern '{pattern}': {name}"

  no_standards_bundle:
    "Project must import at least one standards bundle for compliance tracking"

  stub_detected:
    "SCD '{scd_id}' appears to be a stub. {indicators}"

  no_domain_bundle:
    "Project must import at least one domain bundle (e.g., bundle:software-development:1.0.0)"

# Reporting
reporting:
  summary_format: "text"  # or "json"
  show_recommendations: true
  show_satisfied_concerns: true
  show_missing_recommended: true
  show_domain_summary: true

# Validation Strategy for 0.3
validation_strategy:
  description: "How completeness is validated in 0.3 multi-domain architecture"

  steps:
    1: "Verify project bundle imports at least one domain bundle"
    2: "For each imported domain, identify required concerns"
    3: "Verify each required concern bundle is imported by the domain"
    4: "Verify each concern bundle has minimum required SCDs"
    5: "Check for recommended SCDs in each concern (warnings)"
    6: "Detect stub/placeholder SCDs"
    7: "Validate standards compliance"

  notes:
    - "Domain bundles import concern bundles (not project directly)"
    - "Concerns are reusable across domains"
    - "Projects can import multiple domains (software-development + clinical)"
    - "Each domain defines its own completeness requirements"
