# CLI Audit - January 1, 2026

## Executive Summary

The CLI was built on an **older bundle model** and needs updates to match the **canonical 5-bundle-type model**. The good news: templates are 80% correct, but documentation and some commands need significant updates.

**Status**: üü° **Mostly Functional** - Works but uses outdated terminology and missing domain bundle concept

**Time to Fix**: ~3-4 hours

---

## Critical Issues

### 1. Missing Domain Bundle Concept ‚ö†Ô∏è **CRITICAL**

**Problem**: The CLI has no concept of the "domain bundle" (1 per company, aggregates all concerns).

**Current Model** (OLD):
```
project-bundle
  ‚Üì imports
‚îú‚îÄ meta-bundle
‚îú‚îÄ standards-bundle
‚îî‚îÄ 10 "domain" bundles (architecture, security, etc.)
```

**Correct Model** (NEW):
```
project-bundle
  ‚Üì imports
domain-bundle (THE KEY CONCEPT - MISSING!)
  ‚Üì imports
‚îú‚îÄ concern bundles (architecture, security, etc.)
‚îî‚îÄ standards-bundle
    ‚Üì imports
  meta-bundle
```

**Files Affected**:
- `cli/scs_tools/templates/bundles/project-bundle.yaml` - Lines 12-15 (imports wrong bundles)
- `cli/scs_tools/commands/new.py` - Needs domain bundle creation logic
- `cli/README.md` - Lines 236-250 (calls concerns "domain bundles")

**Fix Required**: Add domain bundle template, update project bundle to import domain instead of concerns directly.

---

### 2. Terminology Confusion ‚ö†Ô∏è **CRITICAL**

**Problem**: CLI calls "concern bundles" ‚Üí "domain bundles" throughout.

**Examples**:
- `cli/README.md` line 236: "Domain Bundles" (should be "Concern Bundles")
- `cli/README.md` lines 238-249: Lists 10 "domains" (actually concerns)
- `cli/scs_tools/commands/bundle.py` line 87: "domain bundles" (should be concern bundles)

**Correct Terminology**:
| OLD (CLI) | NEW (Canonical) | Definition |
|-----------|-----------------|------------|
| "domain bundles" | concern bundles | Functional areas (architecture, security, etc.) |
| (missing) | domain bundle | Company-wide aggregator (1 per company) |

**Fix Required**: Global find/replace + conceptual restructuring.

---

### 3. Bundle Type Constraints Not Validated ‚ö†Ô∏è **HIGH**

**Problem**: Validation doesn't enforce bundle type rules from canonical model.

**Missing Validations**:
- ‚úó Meta bundle: NO imports allowed
- ‚úó Standards bundle: Can import other standards only
- ‚úó Concern bundle: NO imports allowed (leaf nodes)
- ‚úó Domain bundle: MUST import ‚â•1 concern bundle
- ‚úó Project bundle: Typically imports domain bundle

**Files Affected**:
- `cli/scs_tools/commands/validate.py` - Just passes through to scs-validator
- `cli/scs_tools/commands/bundle.py` - `_validate_bundle()` function (lines 397-452)

**Fix Required**: Add bundle type constraint validation.

---

### 4. Loose vs Strict Validation Missing ‚ö†Ô∏è **HIGH**

**Problem**: No support for Phase 1 (loose) vs Phase 2 (strict) validation modes.

**Current**: `scs validate --strict` exists but only fails on warnings
**Needed**:
- Phase 1 (DRAFT): Validate structure, not content completeness
- Phase 2 (Version): Strict validation before immutability

**Files Affected**:
- `cli/scs_tools/commands/validate.py` - Lines 39-41 (--strict flag)
- `cli/README.md` - Lines 277-296 (validation levels documentation)

**Fix Required**: Implement validation mode selection (loose vs strict).

---

## Medium Priority Issues

### 5. Templates Mostly Correct ‚úÖ **GOOD NEWS**

**Status**: Templates have correct structure, just missing domain bundle template.

**What's Correct**:
- ‚úÖ Bundle type field exists in all templates (meta, standards, concern, project)
- ‚úÖ Concern bundles have empty imports (line 7 in all concern templates)
- ‚úÖ Provenance structure correct
- ‚úÖ SCDs array correct

**What's Missing**:
- ‚ùå No `cli/scs_tools/templates/bundles/domain-bundle.yaml` template
- ‚ùå Project bundle imports wrong things (concerns instead of domain)

**Fix Required**: Create domain bundle template, update project bundle template.

---

### 6. Documentation Outdated üìö **MEDIUM**

**Problem**: README describes old model, doesn't explain canonical 5-bundle hierarchy.

**Specific Issues**:
- Lines 199-234: Project structure doesn't show domain bundle
- Lines 236-250: Calls concerns "domains"
- Lines 238-249: Lists "10 domain bundles" (actually concerns)
- No explanation of "build once, use everywhere" domain concept
- No mention of bundle type hierarchy

**Fix Required**: Rewrite documentation sections for canonical model.

---

### 7. Phase References Inconsistent üìã **MEDIUM**

**Problem**: CLI mentions phases but doesn't match current 4-phase workflow.

**Current CLI Phases** (bundle.py lines 586-590):
```yaml
phases:
  phase_1_intent: "completed"
  phase_2_validate: "completed"
  phase_3_version: "completed"
  phase_4_build: "pending"
```

**Correct Phases** (from spec):
1. Phase 1: Build (DRAFT)
2. Phase 2: Validate & Version
3. Phase 3: Deploy
4. Phase 4: Measure & Iterate

**Fix Required**: Update phase naming and workflow documentation.

---

## Low Priority Issues

### 8. MCP References May Exist üîç **LOW**

**Status**: Need to search for deprecated MCP server references.

**Action**: Global search for "MCP" and update to "API server" or "REST API".

---

### 9. Examples Need Updating üìñ **LOW**

**Problem**: Examples in README use old terminology.

**Examples Affected**:
- Lines 311-328: Healthcare project example
- Lines 373-387: Uses outdated bundle structure

**Fix Required**: Update examples to use domain bundle.

---

## Detailed Fix Plan

### Fix 1: Create Domain Bundle Template

**Create**: `cli/scs_tools/templates/bundles/domain-bundle.yaml`

```yaml
id: bundle:{{ company_name }}-domain
type: domain
version: "DRAFT"
title: "{{ company_name }} Domain Bundle"
description: "Company-wide domain bundle that aggregates all concern bundles"

scds: []  # Domain bundles have no SCDs directly

imports:
  # Import all concern bundles
  {% for concern in concerns -%}
  - bundle:{{ concern }}
  {% endfor %}

  # Import standards if needed
  {% if include_standards -%}
  - bundle:standards:1.0.0
  {% endif %}

provenance:
  created_by: "{{ email }}"
  created_at: "{{ created_at }}"
  rationale: >"
    Domain bundle for {{ company_name }}. Aggregates all concern bundles
    to provide comprehensive organizational context. This is the 'build
    once, use everywhere' bundle that every project imports.
```

---

### Fix 2: Update Project Bundle Template

**File**: `cli/scs_tools/templates/bundles/project-bundle.yaml`

**Change Lines 7-15** from:
```yaml
imports:
  # Foundation bundles
  - bundle:meta:1.0.0
  - bundle:standards:1.0.0

  # Domain bundles
  {% for bundle in bundles -%}
  - bundle:{{ bundle }}:1.0.0
  {% endfor %}
```

**To**:
```yaml
imports:
  # Company domain bundle (gets everything!)
  - bundle:{{ company_name }}-domain:1.0.0
```

---

### Fix 3: Add Bundle Type Validation

**File**: `cli/scs_tools/commands/bundle.py`

**Add new function** after line 452:
```python
def _validate_bundle_type_constraints(bundle_path):
    """Validate bundle type-specific constraints."""
    with open(bundle_path, 'r') as f:
        bundle_data = yaml.safe_load(f)

    bundle_type = bundle_data.get('type', 'unknown')
    imports = bundle_data.get('imports', [])
    scds = bundle_data.get('scds', [])

    errors = []

    if bundle_type == 'meta':
        if imports:
            errors.append("Meta bundles must have empty imports")

    elif bundle_type == 'standards':
        # Standards can only import other standards
        for imp in imports:
            if 'standards' not in imp and 'meta' not in imp:
                errors.append(f"Standards bundles can only import other standards or meta, found: {imp}")

    elif bundle_type == 'concern':
        if imports:
            errors.append("Concern bundles must have empty imports (leaf nodes)")
        if not scds or len(scds) == 0:
            errors.append("Concern bundles must have at least 1 SCD")

    elif bundle_type == 'domain':
        if scds:
            errors.append("Domain bundles must have empty scds (aggregates concerns)")

        # Must import at least one concern
        has_concern = any('concern' in imp or
                         not any(x in imp for x in ['meta', 'standards', 'domain', 'project'])
                         for imp in imports)
        if not has_concern:
            errors.append("Domain bundles must import at least 1 concern bundle")

    elif bundle_type == 'project':
        # Projects typically import domain bundle
        pass  # No strict constraints

    return errors
```

---

### Fix 4: Update CLI README

**Replace Section** "Domain Bundles" (lines 236-250):

```markdown
## Bundle Types (Canonical Model)

OICP uses a **5-bundle-type hierarchy** for structured context:

### 1. Meta Bundle
- **What**: SCS vocabulary and foundation
- **Who Creates**: SCS platform
- **Cardinality**: 1 per ecosystem
- **Template**: `bundles/meta-bundle.yaml`

### 2. Standards Bundle
- **What**: External compliance requirements (HIPAA, SOC2, CHAI, etc.)
- **Who Creates**: Standards bodies
- **Cardinality**: Many (one per standard)
- **Template**: `bundles/standards-bundle.yaml`

### 3. Domain Bundle ‚≠ê **KEY CONCEPT**
- **What**: Company-wide aggregator (1 per company)
- **Who Creates**: CTO/CIO
- **Cardinality**: **1 per company**
- **Contains**: NO SCDs directly (imports concerns)
- **Template**: `bundles/domain-bundle.yaml`

**This is "build once, use everywhere"** - Every project imports the domain bundle and gets ALL company context.

### 4. Concern Bundles
- **What**: Functional areas within a company (leaf nodes)
- **Who Creates**: VPs/Directors (Chief Architect, CISO, CMO, etc.)
- **Cardinality**: Variable (based on company needs)
- **Contains**: ‚â•1 project-tier SCD
- **Template**: `bundles/concerns/architecture.yaml` (and 9 others)

**Available Concern Bundles**:
1. Architecture - System design, tech stack, components
2. Security - Authentication, encryption, threats
3. Performance & Reliability - SLAs, fault tolerance
4. Usability & Accessibility - UX, WCAG compliance
5. Compliance & Governance - Regulatory requirements
6. Data & Provenance - Data model, lineage, retention
7. Testing & Validation - Test coverage, QA
8. Deployment & Operations - Infrastructure, monitoring
9. Safety & Risk - Risk assessment, safety checklists
10. Ethics & AI Accountability - AI policy, bias mitigation

### 5. Project Bundle
- **What**: Individual project/initiative (entry point for AI)
- **Who Creates**: Product/Project Managers
- **Cardinality**: Many (one per project)
- **Imports**: Domain bundle (gets everything!)
- **Template**: `bundles/project-bundle.yaml`

---

## Bundle Hierarchy

```
project-bundle (Your app)
  ‚Üì imports
domain-bundle (Your company - built once!)
  ‚Üì imports
‚îú‚îÄ concern: architecture
‚îú‚îÄ concern: security
‚îú‚îÄ concern: compliance
‚îî‚îÄ standards: CHAI
     ‚Üì imports
   meta (SCS foundation)
```
```

---

### Fix 5: Update new.py Command

**File**: `cli/scs_tools/commands/new.py`

**Add** domain bundle creation logic (need to review full file for exact location).

---

### Fix 6: Implement Validation Modes

**File**: `cli/scs_tools/commands/validate.py`

**Add option** after line 41:
```python
@click.option(
    "--mode",
    type=click.Choice(["loose", "strict"], case_sensitive=False),
    default="loose",
    help="Validation mode: loose (Phase 1/DRAFT) or strict (Phase 2/Version)",
)
```

**Update function** to pass mode to validator.

---

## Priority Order for Fixes

1. **CRITICAL** (Do First):
   - Fix 1: Create domain bundle template
   - Fix 2: Update project bundle template
   - Fix 4: Update README documentation

2. **HIGH** (Do Next):
   - Fix 3: Add bundle type constraint validation
   - Fix 6: Implement validation modes
   - Fix 5: Update new.py for domain bundle

3. **MEDIUM** (Can Defer):
   - Update all examples in README
   - Fix phase naming inconsistencies

4. **LOW** (Post-MVP):
   - Search and remove MCP references
   - Update changelog

---

## Testing After Fixes

### Test 1: Create New Project
```bash
scs new project test-project --type standard
# Should create domain bundle in addition to concerns
# Project bundle should import domain bundle
```

### Test 2: Validate Bundle Types
```bash
scs validate bundles/domain-bundle.yaml
# Should check: empty scds, imports ‚â•1 concern

scs validate bundles/concerns/architecture.yaml
# Should check: empty imports, ‚â•1 SCD
```

### Test 3: Loose vs Strict Mode
```bash
scs validate bundles/project-bundle.yaml --mode loose
# Should pass with DRAFT bundles

scs validate bundles/project-bundle.yaml --mode strict
# Should enforce completeness checks
```

---

## Files to Modify

| File | Lines | Type | Priority |
|------|-------|------|----------|
| `templates/bundles/domain-bundle.yaml` | NEW | Create | P0 |
| `templates/bundles/project-bundle.yaml` | 7-15 | Update | P0 |
| `README.md` | 199-250 | Rewrite | P0 |
| `commands/bundle.py` | +new fn | Add validation | P1 |
| `commands/validate.py` | 41+ | Add mode | P1 |
| `commands/new.py` | TBD | Add domain logic | P1 |
| `README.md` | 311-404 | Update examples | P2 |
| `commands/bundle.py` | 586-590 | Fix phases | P2 |

---

## Estimated Effort

- **Phase 1 (Critical Fixes)**: 2-3 hours
- **Phase 2 (High Priority)**: 1-2 hours
- **Phase 3 (Medium Priority)**: 1 hour
- **Phase 4 (Low Priority)**: 30 minutes

**Total**: ~4-6 hours

---

## Recommendation

**Do Critical Fixes NOW** (before Phase 2 testing tomorrow):
1. Create domain bundle template
2. Update project bundle template
3. Update README

**Defer High/Medium** until after you test the control plane:
- You'll learn what validation you actually need
- Control plane testing may reveal other gaps
- Don't over-engineer validation until you know what breaks

---

## Notes

- **Good news**: Templates are 80% correct, just missing domain concept
- **Good news**: Bundle type field exists everywhere
- **Good news**: Provenance structure is correct
- **Bad news**: Documentation is significantly outdated
- **Bad news**: Terminology confusion throughout (domains vs concerns)

The CLI is **usable as-is** for testing, but users will be confused by documentation and terminology mismatches.
